\section{Распространение программного обеспечения в ОС Linux}

В операционных системах \textit{Linux} программное обеспечение находится
в централизованном хранилище, чаще всего располагающихся в Интеренете,
- \textit{репозитории}.Сама программа представляет собой файл, содержащий
информацию о продукте, программные файлы и документацию, - \textit{пакет}. 
Пакеты тесно связаны между собой, к примеру, для установки одного пакета
ему требуется некоторое множество других, так же существуют пакеты, плохо
совместимые друг с другом. 

Вспомогательная информация о пакетах, включая их связи, иначе называемы зависимостями,
хранится в репозитории и называется \textit{индексом}. Если пакет предоставляет 
функциональность других пакетов, то он указывает информацию об этом в тэге \textit{provides}.
Имя \textit{provides} допускает произвольное значение, не обязательно совпадающее с
именем какого-либо существующего  пакета и является, скорее, соглашением, что пакет
обладает некоторой совместимостью. Для \textit{provides} допускается указание подмножества 
версии. Неявными \textit{provides} считаются имена всех файлов, хранимых в пакете.\\

Так же допустимы следующие типы отношений на множестве пакетов, которые так же 
содержатся в информации о пакете:
\begin{itemize}
\item{\textit{Requires}: пакет требует обязательное наличие другого пакета, указанного
по его имени или по одному из его \textit{provides}. Допускается указание 
подмножества версии требуемого пакета. В случае указания ограничения версии
под \textit{requires} может подходить \textit{provides} только дополненный информацией
о версии.}
\item{\textit{Conflicts}: пакет запрещает наличие другого пакета, указанного по его имени
 или по одному из его \textit{provides}. Допускается указание подмножества
версии конфликтуемого пакета. В случае указания ограничения версии
под \textit{conflicts} может подходить \textit{provides} только дополненный информацией
о версии.}
\item{\textit{Obsoletes:} Пакет может указывать, что является обновлением некоторого
множества пакетов. При установке такого пакета все пакеты, обновлением
которых он является, удаляются из ОС. Попытка их установки после
установки обновляющего пакета приводит к ошибке типа ``установлена
более свежая версия''. Допускается указание подмножества версии обновляемых
пакетов. В случае указания ограничения версии под \textit{obsoletes} может
подходить \textit{provides} только дополненный информацией о версии.}
\end{itemize}
%%ССЫЛКА:http://deepsolver.altlinux.org/tech-assignment.pdf

На основе анализа информации, полученной из индекса репозитория,
можно делать выводы о его состоянии. \\

Описанные выше отношения можно представить в виде математической модели,
которая будет проиллюстрирована далее.

%FIXME: здесь ли моддель зависимостей?

\subsection{Пакетные менеджеры}
Так как репозиторий содержит множество пакетов, которые помимо прочего тесно
связаны друг с другом, возникает необходимость в программном обеспечении для
корректного добавления, удаления и обновления пакетов, а так же их инсталляции.
Данные программные продукты называются пакетными менеджерами.\\

Выделяют два уровня пакетных менеджеров:
\begin{itemize}
\item{Пакетные менеджеры первого уровня предоставляют интерфейс для установки,
удаления и обновления пакетов: они позволяют проверить наличие необходимых для
работы устанавливаемой программы компонент подходящей версии непосредственно 
в момент установки, а также производят необходимые процедуры для регистрации 
программы во всех операционных средах пользователя: cразу после установки 
программа может быть доступна пользователю из командной строки.}
\item{Для решения задачи инсталляции пакета, то есть осуществления поиска пакета для
установки по заданным критериям, учитывая его зависимостями, применяется усовершенствованная
система управления пакетами (от англ. Advanced Package Tool). Менеджеры второго уровня являются надстройкой на менеджерами первого
уровня.}
\end{itemize}

Примером пакетного менеджера первого уровня является  \textit{RPM}  - рекурсивный акроним 
\textit{RPM Package Manager}, ранее раскрывался, как \textit{Red Hat Package Manager}.
По сути, менеджером этого уровня определяется формат пакета. Говоря о формате пакетов,
стоит упомянуть, что в зависимости от содержимого выделяют два основных типа пакетов:
\begin{itemize}
\item{Пакеты, включающие исходные коды программ.}
\item{Бинарные пакеты - пакеты, содержащие исполняемые файлы.}
\end{itemize}
RPM относится ко второму виду.\\

Название rpm-пакета состоит из нескольких частей и в общем виде может быть представлено
такой строкой: \\
\textit{name-version-release.architecture.rpm} , где:\\
\begin{itemize}
\item{\textit{name} - имя пакета (чаще всего - название основного приложения, содержащегося в пакете);}
\item{\textit{version} - версия}
\item{\textit{release} - релиз}
\item{\textit{architecture} - архитектура}
\end{itemize}

%FIXME:менеджеры второго уровня, раньше был apt, теперь deepsolver.рассказать про первый
Примером пакетного менеджера, работающего с rpm-пакетами, является \textit{Deepsolver},  система
управления пакетами от компании \textit{ALT Linux}.\\

\subsection{Пакетный менеджер Deepsolver}
Можно выделить две составные части пакетного менеджера Deepsolver:
\begin{itemize}
\item{Клиентская часть предоставляет интерфейс для установки, обновления
 и удаления пакетов на компьютере пользователя.}
\item{Автоматическа сборочница - программная часть, отвечающая за сборку пакетов.
Работает она следующим образом: автор пакета присылает ссылку на \textit{git-репозиторий} с исходным кодом, %%сделать ссылку про git
после чего в строго автоматизированном порядке программа выполняет сборку пакета и кладет
его в репозиторий. Сборка может осуществляться как перед помещением пакета в репозиторий,
так и в любое другое время, если администратор решил пересобрать репозиторий.}
\end{itemize}

\paragraph{Администрирование репозитория}
\textit{Deepsolver} для правильной работы требует выполнения некоторых задач 
администрирования, которые включают в себя задачи обслуживания репозиториев
пакетов и настройку \textit{Deepsolver} на рабочих местах.

Все задачи администрирования репозиториев сводятся к созданию и поддержке в
актуальном состоянии индекса репозитория, который доставляется в первую очередь на компьютеры
пользователей, от его актуальности зависит корректность обработки запросов 
на внесение изменений в состояние ОС. В простейшем варианте индекс
хранит перечисление доступных пакетов с необходимыми атрибутами, включая
полный список \textit{provides}, из-за чего размер файлов индекса становится
чрезмерно большим. Тем не менее, на практике доля \textit{provides}, действительно
задействованных в вычислении зависимостей между пакетами, невелика,
и это даёт возможность для различных оптимизаций размера хранимой информации.

Правильный подход настройки фильтрации \textit{provides} выбирается исходя
из назначения репозитория. Существуют следующие режимы:
\begin{enumerate}
\item{ Фильтрация на основе поиска соответствующих записей \textit{requires/conflicts}.\\
Если репозиторий является единственным источником пакетов для установки
на компьютеры пользователей, и нет других сторонних источников ПО, 
то эффективное сокращение количества provides может быть
достигнуто за счёт включения режима фильтрации на основе известных
\textit{requires/conflicts}. При активации этого режима запись provides сохраняется
в индексе только в том случае, если известна хотя бы одна запись
\textit{requires} или \textit{conflicts}, в которой имя пакета совпадает с именем пакета
в \textit{provides}. Информация о версии в этом случае не учитывается. В терминологии 
Deepsolver соответствующие записи \textit{requires/conflicts} иногда называются ``сылками''.}
\item{ Фильтрация на основе каталогов файлов.\\
 Режим фильтрации \textit{provides} на основе информации о каталоге файла может применяться только для
тех записей \textit{provides}, которые были сгенерированы автоматически на основе
 списка файлов пакета. \textit{Deepsolver} имеет возможность указания списка
каталогов, файлы из которых всегда обрабатываются как допустимые
\textit{provides}. Эта возможность полезна для выполнения запросов на установку
 пакетов по имени файлов. Например, по имени файлов из каталога
\textit{/usr/bin}.}
\end{enumerate}
Если ни один из указанных режимов фильтрации \textit{provides} не используется,
то индекс содержит все возможные \textit{provides}. Если указаны оба из них, то
в индекс попадает \textit{provides}, если он подходит хотя бы под одно правило.

\textit{Deepsolver} предоставляет возможность внесения изменений в индекс без
полной перегенерации, что порождает ряд трудностей при использовании
фильтрации provides на основе известных \textit{requires/conflicts}. При появлении
новых пакетов нарушается общая целостность, поскольку корректное добав-
ление требует восстановления ранее исключённых \textit{provides}. Описанные ниже
утилиты позволяют правильно обновлять содержимое индекса и поддерживать
его в целостном состоянии.

\paragraph{Утилиты для работы с репозитория}
Для решение вышеописанных проблем используются утилиты \textit{ds-repo, ds-patch,
ds-provides}, являющиееся частью упомянутой ранее программы для сборки пакетов.
В качестве одного из аргументов каждая из них требует путь к директории с файлами индекса.\\

\textit{ ds-repo} выполняет все действия по созданию индекса для некоторой
одной компоненты репозитория. Главными параметрами для неё являются
путь к каталогу, где должен быть расположен новый индекс, и множество
путей к каталогам с пакетами, которые должны быть зарегистрированы. 
Целевой каталог создаётся автоматически. Если он уже существует, то не 
должен содержать других каталогов или файлов. Каталоги с пакетами могут
быть перечислены в произвольном порядке и могут содержать как бинарные
пакеты, так и пакеты с исходными текстами. Утилита \textit{ds-repo} автоматически
распознает их тип и помещает в соответствующий раздел индекса. Имена
всех описанных каталогов указываются как свободные параметры командной
строки. На первом месте должен быть указан целевой каталог, за которым
следует перечисление каталогов с пакетами. Пропуск целевого каталога
не допускается. Если ни один из каталогов с пакетами не указан, то 
просматривается текущий каталог, установленный на момент запуска утилиты.\\

Утилита \textit{ds-patch} производит включение и исключение файлов из построенного
индекса Deepsolver. Все параметры, указываемые при вызове\textit{ ds-repo},
повторно перечислять не нужно. Они сохраняются в информационном файле
индекса репозитория и загружаются автоматически при изменении его содержимого.
При запуске \textit{ds-patch} производится проверка контрольных сумм, и
если регистрируется факт обнаружения повреждённого файла, работа завершается
с ошибкой. После работы суммы изменённых файлов обновляются.
При использовании утилиты \textit{ds-patch} необходимо помнить, что утилита
только изменяет набор файлов, перечисленных в индексе, но не обраба-
тывает множество \textit{provides}, которое после изменения теряет целостность и
должно быть отдельно обработано утилитой \textit{ds-provides}, описанной ниже. 
Целостность списка provides нарушается не только в изменённом индексе, но и
во всех других взаимосвязанных компонентах репозитория. Таким образом,
для них также должна быть произведена обработка утилитой \textit{ds-provides}.
Утилита \textit{ds-patch} ожидает указания одного свободного параметра — каталога
с индексом для изменения. Если он не указан, то используется текущий
каталог. Файлы для включения или исключения должны перечисляться после ключей
- \textit{-add} и - \textit{-del} соответственно. Файлы для включения должны быть перечислены 
с указанием абсолютного пути к файлу пакета, в то время как файлы для удаления 
перечисляются просто по своему имени. Как и утилита \textit{ds-repo}, утилита \textit{ds-patch}
производит автоматическое определение типа пакета, и регистрирует его в
соответствующем разделе индекса. Для отделения указания целевого каталога 
от предшествующего перечисления списка файлов необходимо использовать
последовательность``- -''.\\

\paragraph{ds-provides}
Утилита \textit{ds-provides} производит исправление множества \textit{provides} в индексе
некоторой компоненты репозитория после внесения изменений в неё или
в связанные с ней компоненты. Производить запуск этой утилиты требуется
только в том случае, если выбран режим фильтрации provides на основе
списка известных \textit{requires/conlicts}. В качестве свободного параметра при 
вызове указывается путь к каталогу с файлами индекса. Если он отсутствует,
то используется текущий каталог, установленный на момент вызова. В начале
работы утилита \textit{ds-provides} проверяет контрольные суммы, и если они
не совпадают, то завершает работу аварийно. После выполнения всех 
необходимых действий файл с контрольными суммами обновляется. В качестве
дополнительного параметра может быть указан параметр - \textit{-ref-sources},
назначение которого полностью аналогично назначению одноимённого параметра
для утилиты \textit{ds-repo}.

\newpage
\input{Software_dependencies_model}

%%ССЫЛКА: Deepsolver user manual







